"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var checkbox_1 = require("./checkbox");
var _ = require("lodash");
var Moment = require("moment");
var HabbajetBinding = /** @class */ (function () {
    function HabbajetBinding(budget, saveObject, index, name, isNew, frames, value, factor, slack) {
        this.budget = budget;
        this.saveObject = saveObject;
        this.index = index;
        this.name = name;
        this.frames = frames;
        this.value = value;
        this.factor = factor;
        this.slack = slack;
        this.checkboxes = [
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 0),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 1),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 2),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 3),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 4),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 5),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 6)
        ];
        this.transforming = false;
        this.action = 'i';
        this.frame = 0;
        if (isNew) {
            this.state = 0;
            this.saveData();
        }
        else {
            this.value = saveObject.getString("h" + this.index + "value");
            this.name = saveObject.getString("h" + this.index + "name");
            this.state = saveObject.getNumber("h" + this.index + "stateIndex");
            this.factor = saveObject.getNumber("h" + this.index + "factor");
            this.slack = saveObject.getNumber("h" + this.index + "slack");
        }
        this.setState(this.state);
        this.setCheckboxTimes(isNew);
    }
    HabbajetBinding.prototype.dailyUpdate = function (success) {
        if (!this.activeDay.isSet()) {
            this.activeDay.fillCheckbox(success);
            this.checkboxStateUpdate();
            this.locked = true;
            this.saveData();
        }
    };
    HabbajetBinding.prototype.checkboxStateUpdate = function () {
        var newState = 0;
        _.forEach(this.checkboxes, function (c) {
            if (c.isChecked()) {
                newState++;
            }
        });
        if (this.activeDay.time === this.checkboxes[6].time) {
            this.endWeek(newState);
        }
        else {
            this.setState(newState);
        }
    };
    HabbajetBinding.prototype.setImage = function () {
        this.image = "~/images/h" + this.state + "/" + this.action + this.frame + ".png";
        // console.log("image changed to: " + this.image);
    };
    HabbajetBinding.prototype.animate = function () {
        if (this.frames.exists(this.state, this.frame, this.action)) {
            this.setImage();
        }
        else {
            this.makeIdle();
        }
        this.frame++;
    };
    HabbajetBinding.prototype.makeIdle = function () {
        this.resetBusiness();
        this.action = 'i';
        this.restartAnimation();
    };
    HabbajetBinding.prototype.restartAnimation = function () {
        var _this = this;
        clearInterval(this.animationID);
        this.frame = 0;
        this.animationID = setInterval(function () {
            _this.animate();
        }, 100);
    };
    HabbajetBinding.prototype.setState = function (newState) {
        var oldState = this.state;
        this.state = newState;
        if (newState !== oldState) {
            this.transform();
        }
        else {
            this.makeIdle();
        }
    };
    HabbajetBinding.prototype.endWeek = function (successes) {
        this.budget.updateTotal(successes, this.value, this.factor, this.slack);
        this.setState(0);
    };
    HabbajetBinding.prototype.saveData = function () {
        this.saveObject.setString("h" + this.index + "value", this.value);
        this.saveObject.setString("h" + this.index + "name", this.name);
        this.saveObject.setNumber("h" + this.index + "stateIndex", this.state);
        this.saveObject.setNumber("h" + this.index + "factor", this.factor);
        this.saveObject.setNumber("h" + this.index + "slack", this.slack);
    };
    HabbajetBinding.prototype.transform = function () {
        this.transforming = true;
        this.action = 't';
        this.restartAnimation();
    };
    HabbajetBinding.prototype.act = function () {
        if (this.isBusy()) {
            return;
        }
        this.transforming = false;
        var actionType = Math.random() * 2;
        if (actionType < 1 && this.frames.exists(this.state, 0, 'a')) {
            this.action = 'a';
        }
        else if (this.frames.exists(this.state, 0, 'b')) {
            this.action = 'b';
        }
        this.restartAnimation();
    };
    HabbajetBinding.prototype.resetBusiness = function () {
        this.transforming = false;
    };
    HabbajetBinding.prototype.isBusy = function () {
        return this.transforming;
    };
    HabbajetBinding.prototype.update = function (newName, newValue) {
        this.name = newName;
        this.value = newValue;
    };
    HabbajetBinding.prototype.updateIndex = function (newIndex) {
        this.deleteData();
        this.index = newIndex;
        this.saveData();
        this.changeCheckboxIndices();
    };
    HabbajetBinding.prototype.deleteData = function () {
        this.saveObject.remove("h" + this.index + "value");
        this.saveObject.remove("h" + this.index + "name");
        this.saveObject.remove("h" + this.index + "stateIndex");
        this.saveObject.remove("h" + this.index + "factor");
        this.saveObject.remove("h" + this.index + "slack");
    };
    HabbajetBinding.prototype.setCheckboxTimes = function (isNew) {
        var today = Moment().startOf('week').subtract(1, 'days');
        if (!isNew && this.checkboxes[6].time < today.valueOf()) {
            if (!this.checkboxes[6].isSet()) {
                var numChecked_1 = 0;
                _.forEach(this.checkboxes, function (c) {
                    if (c.isChecked()) {
                        numChecked_1++;
                    }
                });
                this.state = 0;
                this.endWeek(numChecked_1);
            }
            _.forEach(this.checkboxes, function (c) {
                c.reset();
            });
        }
        for (var i = 0; i < 7; i++) {
            this.checkboxes[i].setTime(today.add(1, 'days').format('dddd Do MMM'), today.valueOf());
            if (this.checkboxes[i].time < Moment().endOf('day').valueOf()) {
                this.activeDay = this.checkboxes[i];
            }
        }
        this.locked = this.activeDay.isSet();
    };
    HabbajetBinding.prototype.changeCheckboxIndices = function () {
        for (var i = 0; i < 7; i++) {
            this.checkboxes[i].changeIndex(this.index);
        }
    };
    HabbajetBinding.prototype.updateTabText = function (maxChars) {
        if (this.name.length > maxChars) {
            this.tabName = this.name.substring(0, maxChars);
        }
        else {
            this.tabName = this.name;
        }
    };
    HabbajetBinding.prototype.switchDay = function (index) {
        this.activeDay = this.checkboxes[index];
        this.locked = this.activeDay.isSet();
    };
    return HabbajetBinding;
}());
exports.HabbajetBinding = HabbajetBinding;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFiYmFqZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJoYWJiYWpldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUE2QztBQUM3QywwQkFBNEI7QUFJNUIsK0JBQWlDO0FBRWpDO0lBY0UseUJBQW9CLE1BQXFCLEVBQVUsVUFBZSxFQUN0RCxLQUFhLEVBQVMsSUFBWSxFQUFFLEtBQWMsRUFDbEQsTUFBbUIsRUFBUyxLQUFhLEVBQVUsTUFBYyxFQUFVLEtBQWE7UUFGaEYsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUFVLGVBQVUsR0FBVixVQUFVLENBQUs7UUFDdEQsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUFTLFNBQUksR0FBSixJQUFJLENBQVE7UUFDbEMsV0FBTSxHQUFOLE1BQU0sQ0FBYTtRQUFTLFVBQUssR0FBTCxLQUFLLENBQVE7UUFBVSxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUVsRyxJQUFJLENBQUMsVUFBVSxHQUFHO1lBQ2hCLElBQUksMEJBQWUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDaEQsSUFBSSwwQkFBZSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNoRCxJQUFJLDBCQUFlLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hELElBQUksMEJBQWUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDaEQsSUFBSSwwQkFBZSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNoRCxJQUFJLDBCQUFlLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hELElBQUksMEJBQWUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxD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QUM7SUFDSCxDQUFDO0lBRUQsdUNBQWEsR0FBYixVQUFjLFFBQVc7UUFDdkIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNsRCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDM0IsQ0FBQztJQUNILENBQUM7SUFFRCxtQ0FBUyxHQUFULFVBQVUsS0FBYTtRQUNyQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFDSCxzQkFBQztBQUFELENBQUMsQUFyTkQsSUFxTkM7QUFyTlksMENBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGVja2JveEJpbmRpbmcgfSBmcm9tIFwiLi9jaGVja2JveFwiO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCAqIGFzIERpYWxvZ3MgZnJvbSAndWkvZGlhbG9ncyc7XHJcbmltcG9ydCB7IEJ1ZGdldEJpbmRpbmcgfSBmcm9tIFwiLi9idWRnZXRcIjtcclxuaW1wb3J0IHsgRnJhbWVDb3VudHMgfSBmcm9tIFwiLi9mcmFtZS1jb3VudHNcIjtcclxuaW1wb3J0ICogYXMgTW9tZW50IGZyb20gXCJtb21lbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBIYWJiYWpldEJpbmRpbmcge1xyXG4gIHByaXZhdGUgc3RhdGU6IG51bWJlcjtcclxuICBwcml2YXRlIGZyYW1lOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBhY3Rpb246IHN0cmluZztcclxuICBwdWJsaWMgaW1hZ2U6IHN0cmluZztcclxuICBwdWJsaWMgY2hlY2tib3hlczogQ2hlY2tib3hCaW5kaW5nW107XHJcbiAgcHVibGljIGFjdGl2ZURheTogQ2hlY2tib3hCaW5kaW5nO1xyXG4gIHB1YmxpYyBhbmltYXRpbmc6IGJvb2xlYW47XHJcbiAgcHVibGljIGFuaW1hdGlvbklEOiBudW1iZXI7XHJcbiAgcHVibGljIHRhYk5hbWU6IHN0cmluZztcclxuXHJcbiAgcHVibGljIHRyYW5zZm9ybWluZzogYm9vbGVhbjtcclxuICBwdWJsaWMgbG9ja2VkOiBib29sZWFuO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJ1ZGdldDogQnVkZ2V0QmluZGluZywgcHJpdmF0ZSBzYXZlT2JqZWN0OiBhbnksXHJcbiAgICAgIHByaXZhdGUgaW5kZXg6IG51bWJlciwgcHVibGljIG5hbWU6IHN0cmluZywgaXNOZXc6IGJvb2xlYW4sXHJcbiAgICAgIHByaXZhdGUgZnJhbWVzOiBGcmFtZUNvdW50cywgcHVibGljIHZhbHVlOiBzdHJpbmcsIHByaXZhdGUgZmFjdG9yOiBudW1iZXIsIHByaXZhdGUgc2xhY2s6IG51bWJlcikge1xyXG4gICAgXHJcbiAgICB0aGlzLmNoZWNrYm94ZXMgPSBbXHJcbiAgICAgIG5ldyBDaGVja2JveEJpbmRpbmcoc2F2ZU9iamVjdCwgaW5kZXgsIGlzTmV3LCAwKSxcclxuICAgICAgbmV3IENoZWNrYm94QmluZGluZyhzYXZlT2JqZWN0LCBpbmRleCwgaXNOZXcsIDEpLFxyXG4gICAgICBuZXcgQ2hlY2tib3hCaW5kaW5nKHNhdmVPYmplY3QsIGluZGV4LCBpc05ldywgMiksXHJcbiAgICAgIG5ldyBDaGVja2JveEJpbmRpbmcoc2F2ZU9iamVjdCwgaW5kZXgsIGlzTmV3LCAzKSxcclxuICAgICAgbmV3IENoZWNrYm94QmluZGluZyhzYXZlT2JqZWN0LCBpbmRleCwgaXNOZXcsIDQpLFxyXG4gICAgICBuZXcgQ2hlY2tib3hCaW5kaW5nKHNhdmVPYmplY3QsIGluZGV4LCBpc05ldywgNSksXHJcbiAgICAgIG5ldyBDaGVja2JveEJpbmRpbmcoc2F2ZU9iamVjdCwgaW5kZXgsIGlzTmV3LCA2KVxyXG4gICAgXTtcclxuICAgIFxyXG4gICAgdGhpcy4gdHJhbnNmb3JtaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLmFjdGlvbiA9ICdpJztcclxuICAgIHRoaXMuZnJhbWUgPSAwO1xyXG4gICAgaWYoaXNOZXcpIHtcclxuICAgICAgdGhpcy5zdGF0ZSA9IDA7XHJcbiAgICAgIHRoaXMuc2F2ZURhdGEoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudmFsdWUgPSBzYXZlT2JqZWN0LmdldFN0cmluZyhcImhcIiArIHRoaXMuaW5kZXggKyBcInZhbHVlXCIpXHJcbiAgICAgIHRoaXMubmFtZSA9IHNhdmVPYmplY3QuZ2V0U3RyaW5nKFwiaFwiICsgdGhpcy5pbmRleCArIFwibmFtZVwiKTtcclxuICAgICAgdGhpcy5zdGF0ZSA9IHNhdmVPYmplY3QuZ2V0TnVtYmVyKFwiaFwiICsgdGhpcy5pbmRleCArIFwic3RhdGVJbmRleFwiKTtcclxuICAgICAgdGhpcy5mYWN0b3IgPSBzYXZlT2JqZWN0LmdldE51bWJlcihcImhcIiArIHRoaXMuaW5kZXggKyBcImZhY3RvclwiKTtcclxuICAgICAgdGhpcy5zbGFjayA9IHNhdmVPYmplY3QuZ2V0TnVtYmVyKFwiaFwiICsgdGhpcy5pbmRleCArIFwic2xhY2tcIik7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNldFN0YXRlKHRoaXMuc3RhdGUpO1xyXG4gICAgdGhpcy5zZXRDaGVja2JveFRpbWVzKGlzTmV3KTtcclxuICB9XHJcblxyXG4gIGRhaWx5VXBkYXRlKHN1Y2Nlc3M6IGJvb2xlYW4pIHtcclxuICAgIGlmKCF0aGlzLmFjdGl2ZURheS5pc1NldCgpKSB7XHJcbiAgICAgIHRoaXMuYWN0aXZlRGF5LmZpbGxDaGVja2JveChzdWNjZXNzKTtcclxuICAgICAgdGhpcy5jaGVja2JveFN0YXRlVXBkYXRlKCk7XHJcbiAgICAgIHRoaXMubG9ja2VkID0gdHJ1ZTtcclxuICAgICAgdGhpcy5zYXZlRGF0YSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2hlY2tib3hTdGF0ZVVwZGF0ZSgpIHtcclxuICAgIGxldCBuZXdTdGF0ZSA9IDA7XHJcbiAgICBfLmZvckVhY2godGhpcy5jaGVja2JveGVzLCAoYykgPT4ge1xyXG4gICAgICBpZihjLmlzQ2hlY2tlZCgpKSB7XHJcbiAgICAgICAgbmV3U3RhdGUrKztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYodGhpcy5hY3RpdmVEYXkudGltZSA9PT0gdGhpcy5jaGVja2JveGVzWzZdLnRpbWUpIHtcclxuICAgICAgdGhpcy5lbmRXZWVrKG5ld1N0YXRlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgc2V0SW1hZ2UoKSB7XHJcbiAgICB0aGlzLmltYWdlID0gXCJ+L2ltYWdlcy9oXCIgKyB0aGlzLnN0YXRlICsgXCIvXCIgKyB0aGlzLmFjdGlvbiArIHRoaXMuZnJhbWUgKyBcIi5wbmdcIjtcclxuICAgIC8vIGNvbnNvbGUubG9nKFwiaW1hZ2UgY2hhbmdlZCB0bzogXCIgKyB0aGlzLmltYWdlKTtcclxuICB9XHJcblxyXG4gIGFuaW1hdGUoKSB7XHJcbiAgICAgIGlmKHRoaXMuZnJhbWVzLmV4aXN0cyh0aGlzLnN0YXRlLCB0aGlzLmZyYW1lLCB0aGlzLmFjdGlvbikpIHtcclxuICAgICAgICB0aGlzLnNldEltYWdlKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5tYWtlSWRsZSgpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuZnJhbWUrKztcclxuICB9XHJcblxyXG4gIG1ha2VJZGxlKCkge1xyXG4gICAgdGhpcy5yZXNldEJ1c2luZXNzKCk7XHJcbiAgICB0aGlzLmFjdGlvbiA9ICdpJztcclxuICAgIHRoaXMucmVzdGFydEFuaW1hdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgcmVzdGFydEFuaW1hdGlvbigpIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5hbmltYXRpb25JRCk7XHJcbiAgICB0aGlzLmZyYW1lID0gMDtcclxuICAgIHRoaXMuYW5pbWF0aW9uSUQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuYW5pbWF0ZSgpO1xyXG4gICAgfSwgMTAwKTtcclxuICB9XHJcblxyXG4gIHNldFN0YXRlKG5ld1N0YXRlOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IG9sZFN0YXRlID0gdGhpcy5zdGF0ZTtcclxuICAgIHRoaXMuc3RhdGUgPSBuZXdTdGF0ZTtcclxuICAgIGlmKG5ld1N0YXRlICE9PSBvbGRTdGF0ZSkge1xyXG4gICAgICB0aGlzLnRyYW5zZm9ybSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tYWtlSWRsZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZW5kV2VlayhzdWNjZXNzZXM6IG51bWJlcikge1xyXG4gICAgdGhpcy5idWRnZXQudXBkYXRlVG90YWwoc3VjY2Vzc2VzLCB0aGlzLnZhbHVlLCB0aGlzLmZhY3RvciwgdGhpcy5zbGFjayk7XHJcbiAgICB0aGlzLnNldFN0YXRlKDApO1xyXG4gIH1cclxuXHJcbiAgc2F2ZURhdGEoKSB7XHJcbiAgICB0aGlzLnNhdmVPYmplY3Quc2V0U3RyaW5nKFwiaFwiICsgdGhpcy5pbmRleCArIFwidmFsdWVcIiwgdGhpcy52YWx1ZSk7XHJcbiAgICB0aGlzLnNhdmVPYmplY3Quc2V0U3RyaW5nKFwiaFwiICsgdGhpcy5pbmRleCArIFwibmFtZVwiLCB0aGlzLm5hbWUpO1xyXG4gICAgdGhpcy5zYXZlT2JqZWN0LnNldE51bWJlcihcImhcIiArIHRoaXMuaW5kZXggKyBcInN0YXRlSW5kZXhcIiwgdGhpcy5zdGF0ZSk7XHJcbiAgICB0aGlzLnNhdmVPYmplY3Quc2V0TnVtYmVyKFwiaFwiICsgdGhpcy5pbmRleCArIFwiZmFjdG9yXCIsIHRoaXMuZmFjdG9yKTtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5zZXROdW1iZXIoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJzbGFja1wiLCB0aGlzLnNsYWNrKTtcclxuICB9XHJcblxyXG4gIHRyYW5zZm9ybSgpIHtcclxuICAgIHRoaXMudHJhbnNmb3JtaW5nID0gdHJ1ZTtcclxuICAgIHRoaXMuYWN0aW9uID0gJ3QnO1xyXG4gICAgdGhpcy5yZXN0YXJ0QW5pbWF0aW9uKCk7XHJcbiAgfVxyXG5cclxuICBhY3QoKSB7XHJcbiAgICBpZiAodGhpcy5pc0J1c3koKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnRyYW5zZm9ybWluZyA9IGZhbHNlO1xyXG4gICAgY29uc3QgYWN0aW9uVHlwZSA9IE1hdGgucmFuZG9tKCkgKiAyXHJcbiAgICBpZihhY3Rpb25UeXBlIDwgMSAmJiB0aGlzLmZyYW1lcy5leGlzdHModGhpcy5zdGF0ZSwgMCwgJ2EnKSkge1xyXG4gICAgICB0aGlzLmFjdGlvbiA9ICdhJztcclxuICAgIH0gZWxzZSBpZih0aGlzLmZyYW1lcy5leGlzdHModGhpcy5zdGF0ZSwgMCwgJ2InKSkge1xyXG4gICAgICB0aGlzLmFjdGlvbiA9ICdiJztcclxuICAgIH1cclxuICAgIHRoaXMucmVzdGFydEFuaW1hdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRCdXNpbmVzcygpIHtcclxuICAgIHRoaXMudHJhbnNmb3JtaW5nID0gZmFsc2U7XHJcbiAgfVxyXG5cclxuICBpc0J1c3koKSB7XHJcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1pbmc7XHJcbiAgfVxyXG5cclxuICB1cGRhdGUobmV3TmFtZTogc3RyaW5nLCBuZXdWYWx1ZTogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm5hbWUgPSBuZXdOYW1lO1xyXG4gICAgdGhpcy52YWx1ZSA9IG5ld1ZhbHVlO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlSW5kZXgobmV3SW5kZXg6IG51bWJlcikge1xyXG4gICAgdGhpcy5kZWxldGVEYXRhKCk7XHJcbiAgICB0aGlzLmluZGV4ID0gbmV3SW5kZXg7XHJcbiAgICB0aGlzLnNhdmVEYXRhKCk7XHJcbiAgICB0aGlzLmNoYW5nZUNoZWNrYm94SW5kaWNlcygpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlRGF0YSgpIHtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5yZW1vdmUoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJ2YWx1ZVwiKTtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5yZW1vdmUoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJuYW1lXCIpO1xyXG4gICAgdGhpcy5zYXZlT2JqZWN0LnJlbW92ZShcImhcIiArIHRoaXMuaW5kZXggKyBcInN0YXRlSW5kZXhcIik7XHJcbiAgICB0aGlzLnNhdmVPYmplY3QucmVtb3ZlKFwiaFwiICsgdGhpcy5pbmRleCArIFwiZmFjdG9yXCIpO1xyXG4gICAgdGhpcy5zYXZlT2JqZWN0LnJlbW92ZShcImhcIiArIHRoaXMuaW5kZXggKyBcInNsYWNrXCIpO1xyXG4gIH1cclxuXHJcbiAgc2V0Q2hlY2tib3hUaW1lcyhpc05ldzogYm9vbGVhbikge1xyXG4gICAgbGV0IHRvZGF5ID0gTW9tZW50KCkuc3RhcnRPZignd2VlaycpLnN1YnRyYWN0KDEsICdkYXlzJyk7XHJcbiAgICBpZighaXNOZXcgJiYgIHRoaXMuY2hlY2tib3hlc1s2XS50aW1lIDwgdG9kYXkudmFsdWVPZigpKSB7XHJcbiAgICAgIGlmKCF0aGlzLmNoZWNrYm94ZXNbNl0uaXNTZXQoKSkge1xyXG4gICAgICAgIGxldCBudW1DaGVja2VkID0gMDtcclxuICAgICAgICBfLmZvckVhY2godGhpcy5jaGVja2JveGVzLCAoYykgPT4ge1xyXG4gICAgICAgICAgaWYoYy5pc0NoZWNrZWQoKSkge1xyXG4gICAgICAgICAgICBudW1DaGVja2VkKys7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDA7XHJcbiAgICAgICAgdGhpcy5lbmRXZWVrKG51bUNoZWNrZWQpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBfLmZvckVhY2godGhpcy5jaGVja2JveGVzLCAoYykgPT4ge1xyXG4gICAgICAgIGMucmVzZXQoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDc7IGkrKykge1xyXG4gICAgICB0aGlzLmNoZWNrYm94ZXNbaV0uc2V0VGltZSh0b2RheS5hZGQoMSwgJ2RheXMnKS5mb3JtYXQoJ2RkZGQgRG8gTU1NJyksIHRvZGF5LnZhbHVlT2YoKSk7XHJcbiAgICAgIGlmKHRoaXMuY2hlY2tib3hlc1tpXS50aW1lIDwgTW9tZW50KCkuZW5kT2YoJ2RheScpLnZhbHVlT2YoKSkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlRGF5ID0gdGhpcy5jaGVja2JveGVzW2ldO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmxvY2tlZCA9IHRoaXMuYWN0aXZlRGF5LmlzU2V0KCk7XHJcbiAgfVxyXG5cclxuICBjaGFuZ2VDaGVja2JveEluZGljZXMoKSB7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDc7IGkrKykge1xyXG4gICAgICB0aGlzLmNoZWNrYm94ZXNbaV0uY2hhbmdlSW5kZXgodGhpcy5pbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGVUYWJUZXh0KG1heENoYXJzOiAwKSB7XHJcbiAgICBpZih0aGlzLm5hbWUubGVuZ3RoID4gbWF4Q2hhcnMpIHtcclxuICAgICAgdGhpcy50YWJOYW1lID0gdGhpcy5uYW1lLnN1YnN0cmluZygwLCBtYXhDaGFycyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnRhYk5hbWUgPSB0aGlzLm5hbWU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzd2l0Y2hEYXkoaW5kZXg6IG51bWJlcikge1xyXG4gICAgdGhpcy5hY3RpdmVEYXkgPSB0aGlzLmNoZWNrYm94ZXNbaW5kZXhdO1xyXG4gICAgdGhpcy5sb2NrZWQgPSB0aGlzLmFjdGl2ZURheS5pc1NldCgpO1xyXG4gIH1cclxufSJdfQ==
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var checkbox_1 = require("./checkbox");
var _ = require("lodash");
var frame_counts_1 = require("./frame-counts");
var Moment = require("moment");
var HabbajetBinding = /** @class */ (function () {
    function HabbajetBinding(budget, saveObject, index, name, isNew, value, factor, slack) {
        this.budget = budget;
        this.saveObject = saveObject;
        this.index = index;
        this.name = name;
        this.value = value;
        this.factor = factor;
        this.slack = slack;
        this.checkboxes = [
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 0),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 1),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 2),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 3),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 4),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 5),
            new checkbox_1.CheckboxBinding(saveObject, index, isNew, 6)
        ];
        this.transforming = false;
        this.action = 'i';
        this.frame = 0;
        if (isNew) {
            this.state = 0;
            this.saveData();
        }
        else {
            this.value = saveObject.getString("h" + this.index + "value");
            this.name = saveObject.getString("h" + this.index + "name");
            this.state = saveObject.getNumber("h" + this.index + "stateIndex");
            this.factor = saveObject.getNumber("h" + this.index + "factor");
            this.slack = saveObject.getNumber("h" + this.index + "slack");
        }
        this.setState(this.state);
        this.setCheckboxTimes(isNew);
    }
    HabbajetBinding.prototype.dailyUpdate = function (success) {
        if (!this.activeDay.isSet()) {
            this.activeDay.fillCheckbox(success);
            this.checkboxStateUpdate();
            this.locked = true;
            this.saveData();
        }
    };
    HabbajetBinding.prototype.checkboxStateUpdate = function () {
        var newState = 0;
        _.forEach(this.checkboxes, function (c) {
            if (c.isChecked()) {
                newState++;
            }
        });
        if (this.activeDay.time === this.checkboxes[6].time) {
            this.endWeek(newState);
        }
        else {
            this.setState(newState);
        }
    };
    HabbajetBinding.prototype.setImage = function () {
        this.image = "~/images/h" + this.state + "/" + this.action + this.frame + ".png";
        // console.log("image changed to: " + this.image);
    };
    HabbajetBinding.prototype.animate = function () {
        if (frame_counts_1.frameCounts(this.action + this.state) > this.frame) {
            this.setImage();
        }
        else {
            this.makeIdle();
        }
        this.frame++;
    };
    HabbajetBinding.prototype.makeIdle = function () {
        this.resetBusiness();
        this.action = 'i';
        this.restartAnimation();
    };
    HabbajetBinding.prototype.restartAnimation = function () {
        var _this = this;
        clearInterval(this.animationID);
        this.frame = 0;
        this.animationID = setInterval(function () {
            _this.animate();
        }, 100);
    };
    HabbajetBinding.prototype.setState = function (newState) {
        var oldState = this.state;
        this.state = newState;
        if (newState !== oldState) {
            this.transform();
        }
        else {
            this.makeIdle();
        }
    };
    HabbajetBinding.prototype.endWeek = function (successes) {
        this.budget.updateTotal(successes, this.value, this.factor, this.slack);
        this.setState(0);
    };
    HabbajetBinding.prototype.saveData = function () {
        this.saveObject.setString("h" + this.index + "value", this.value);
        this.saveObject.setString("h" + this.index + "name", this.name);
        this.saveObject.setNumber("h" + this.index + "stateIndex", this.state);
        this.saveObject.setNumber("h" + this.index + "factor", this.factor);
        this.saveObject.setNumber("h" + this.index + "slack", this.slack);
    };
    HabbajetBinding.prototype.transform = function () {
        this.transforming = true;
        this.action = 't';
        this.restartAnimation();
    };
    HabbajetBinding.prototype.act = function () {
        if (this.isBusy()) {
            return;
        }
        this.transforming = false;
        var actionType = Math.random() * 2;
        if (actionType < 1 && frame_counts_1.frameCounts('a' + 0) > 0) {
            this.action = 'a';
        }
        else if (frame_counts_1.frameCounts('b' + 0) > 0) {
            this.action = 'b';
        }
        this.restartAnimation();
    };
    HabbajetBinding.prototype.resetBusiness = function () {
        this.transforming = false;
    };
    HabbajetBinding.prototype.isBusy = function () {
        return this.transforming;
    };
    HabbajetBinding.prototype.update = function (newName, newValue) {
        this.name = newName;
        this.value = newValue;
    };
    HabbajetBinding.prototype.updateIndex = function (newIndex) {
        this.deleteData();
        this.index = newIndex;
        this.saveData();
        this.changeCheckboxIndices();
    };
    HabbajetBinding.prototype.deleteData = function () {
        this.saveObject.remove("h" + this.index + "value");
        this.saveObject.remove("h" + this.index + "name");
        this.saveObject.remove("h" + this.index + "stateIndex");
        this.saveObject.remove("h" + this.index + "factor");
        this.saveObject.remove("h" + this.index + "slack");
    };
    HabbajetBinding.prototype.setCheckboxTimes = function (isNew) {
        var today = Moment().startOf('week').subtract(1, 'days');
        if (!isNew && this.checkboxes[6].time < today.valueOf()) {
            if (!this.checkboxes[6].isSet()) {
                var numChecked_1 = 0;
                _.forEach(this.checkboxes, function (c) {
                    if (c.isChecked()) {
                        numChecked_1++;
                    }
                });
                this.state = 0;
                this.endWeek(numChecked_1);
            }
            _.forEach(this.checkboxes, function (c) {
                c.reset();
            });
        }
        for (var i = 0; i < 7; i++) {
            this.checkboxes[i].setTime(today.add(1, 'days').format('dddd Do MMM'), today.valueOf());
            if (this.checkboxes[i].time < Moment().endOf('day').valueOf()) {
                this.activeDay = this.checkboxes[i];
            }
        }
        this.locked = this.activeDay.isSet();
    };
    HabbajetBinding.prototype.changeCheckboxIndices = function () {
        for (var i = 0; i < 7; i++) {
            this.checkboxes[i].changeIndex(this.index);
        }
    };
    HabbajetBinding.prototype.updateTabText = function (maxChars) {
        if (this.name.length > maxChars) {
            this.tabName = this.name.substring(0, maxChars);
        }
        else {
            this.tabName = this.name;
        }
    };
    HabbajetBinding.prototype.switchDay = function (index) {
        this.activeDay = this.checkboxes[index];
        this.locked = this.activeDay.isSet() || this.checkboxes[6].isSet();
    };
    return HabbajetBinding;
}());
exports.HabbajetBinding = HabbajetBinding;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFiYmFqZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJoYWJiYWpldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUE2QztBQUM3QywwQkFBNEI7QUFHNUIsK0NBQTZDO0FBQzdDLCtCQUFpQztBQUVqQztJQWNFLHlCQUFvQixNQUFxQixFQUFVLFVBQWUsRUFDdEQsS0FBYSxFQUFTLElBQVksRUFBRSxLQUFjLEVBQ25ELEtBQWEsRUFBVSxNQUFjLEVBQVUsS0FBYTtRQUZuRCxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBSztRQUN0RCxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQVMsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNuQyxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQVUsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLFVBQUssR0FBTCxLQUFLLENBQVE7UUFFckUsSUFBSSxDQUFDLFVBQVUsR0FBRztZQUNoQixJQUFJLDBCQUFlLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hELElBQUksMEJBQWUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDaEQsSUFBSSwwQkFBZSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNoRCxJQUFJLDBCQUFlLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hELElBQUksMEJBQWUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDaEQsSUFBSSwwQkFBZSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNoRCxJQUFJLDBCQUFlLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQ2pELENBQUM7UUFF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QUFDLENBQUM7WUFDL0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDbEQsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzNCLENBQUM7SUFDSCxDQUFDO0lBRUQsbUNBQVMsR0FBVCxVQUFVLEtBQWE7UUFDckIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JFLENBQUM7SUFDSCxzQkFBQztBQUFELENBQUMsQUFyTkQsSUFxTkM7QUFyTlksMENBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGVja2JveEJpbmRpbmcgfSBmcm9tIFwiLi9jaGVja2JveFwiO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcbmltcG9ydCAqIGFzIERpYWxvZ3MgZnJvbSAndWkvZGlhbG9ncyc7XHJcbmltcG9ydCB7IEJ1ZGdldEJpbmRpbmcgfSBmcm9tIFwiLi9idWRnZXRcIjtcclxuaW1wb3J0IHsgZnJhbWVDb3VudHMgfSBmcm9tIFwiLi9mcmFtZS1jb3VudHNcIjtcclxuaW1wb3J0ICogYXMgTW9tZW50IGZyb20gXCJtb21lbnRcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBIYWJiYWpldEJpbmRpbmcge1xyXG4gIHByaXZhdGUgc3RhdGU6IG51bWJlcjtcclxuICBwcml2YXRlIGZyYW1lOiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBhY3Rpb246IHN0cmluZztcclxuICBwdWJsaWMgaW1hZ2U6IHN0cmluZztcclxuICBwdWJsaWMgY2hlY2tib3hlczogQ2hlY2tib3hCaW5kaW5nW107XHJcbiAgcHVibGljIGFjdGl2ZURheTogQ2hlY2tib3hCaW5kaW5nO1xyXG4gIHB1YmxpYyBhbmltYXRpbmc6IGJvb2xlYW47XHJcbiAgcHVibGljIGFuaW1hdGlvbklEOiBudW1iZXI7XHJcbiAgcHVibGljIHRhYk5hbWU6IHN0cmluZztcclxuXHJcbiAgcHVibGljIHRyYW5zZm9ybWluZzogYm9vbGVhbjtcclxuICBwdWJsaWMgbG9ja2VkOiBib29sZWFuO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJ1ZGdldDogQnVkZ2V0QmluZGluZywgcHJpdmF0ZSBzYXZlT2JqZWN0OiBhbnksXHJcbiAgICAgIHByaXZhdGUgaW5kZXg6IG51bWJlciwgcHVibGljIG5hbWU6IHN0cmluZywgaXNOZXc6IGJvb2xlYW4sXHJcbiAgICAgIHB1YmxpYyB2YWx1ZTogc3RyaW5nLCBwcml2YXRlIGZhY3RvcjogbnVtYmVyLCBwcml2YXRlIHNsYWNrOiBudW1iZXIpIHtcclxuICAgIFxyXG4gICAgdGhpcy5jaGVja2JveGVzID0gW1xyXG4gICAgICBuZXcgQ2hlY2tib3hCaW5kaW5nKHNhdmVPYmplY3QsIGluZGV4LCBpc05ldywgMCksXHJcbiAgICAgIG5ldyBDaGVja2JveEJpbmRpbmcoc2F2ZU9iamVjdCwgaW5kZXgsIGlzTmV3LCAxKSxcclxuICAgICAgbmV3IENoZWNrYm94QmluZGluZyhzYXZlT2JqZWN0LCBpbmRleCwgaXNOZXcsIDIpLFxyXG4gICAgICBuZXcgQ2hlY2tib3hCaW5kaW5nKHNhdmVPYmplY3QsIGluZGV4LCBpc05ldywgMyksXHJcbiAgICAgIG5ldyBDaGVja2JveEJpbmRpbmcoc2F2ZU9iamVjdCwgaW5kZXgsIGlzTmV3LCA0KSxcclxuICAgICAgbmV3IENoZWNrYm94QmluZGluZyhzYXZlT2JqZWN0LCBpbmRleCwgaXNOZXcsIDUpLFxyXG4gICAgICBuZXcgQ2hlY2tib3hCaW5kaW5nKHNhdmVPYmplY3QsIGluZGV4LCBpc05ldywgNilcclxuICAgIF07XHJcbiAgICBcclxuICAgIHRoaXMuIHRyYW5zZm9ybWluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy5hY3Rpb24gPSAnaSc7XHJcbiAgICB0aGlzLmZyYW1lID0gMDtcclxuICAgIGlmKGlzTmV3KSB7XHJcbiAgICAgIHRoaXMuc3RhdGUgPSAwO1xyXG4gICAgICB0aGlzLnNhdmVEYXRhKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnZhbHVlID0gc2F2ZU9iamVjdC5nZXRTdHJpbmcoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJ2YWx1ZVwiKVxyXG4gICAgICB0aGlzLm5hbWUgPSBzYXZlT2JqZWN0LmdldFN0cmluZyhcImhcIiArIHRoaXMuaW5kZXggKyBcIm5hbWVcIik7XHJcbiAgICAgIHRoaXMuc3RhdGUgPSBzYXZlT2JqZWN0LmdldE51bWJlcihcImhcIiArIHRoaXMuaW5kZXggKyBcInN0YXRlSW5kZXhcIik7XHJcbiAgICAgIHRoaXMuZmFjdG9yID0gc2F2ZU9iamVjdC5nZXROdW1iZXIoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJmYWN0b3JcIik7XHJcbiAgICAgIHRoaXMuc2xhY2sgPSBzYXZlT2JqZWN0LmdldE51bWJlcihcImhcIiArIHRoaXMuaW5kZXggKyBcInNsYWNrXCIpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5zZXRTdGF0ZSh0aGlzLnN0YXRlKTtcclxuICAgIHRoaXMuc2V0Q2hlY2tib3hUaW1lcyhpc05ldyk7XHJcbiAgfVxyXG5cclxuICBkYWlseVVwZGF0ZShzdWNjZXNzOiBib29sZWFuKSB7XHJcbiAgICBpZighdGhpcy5hY3RpdmVEYXkuaXNTZXQoKSkge1xyXG4gICAgICB0aGlzLmFjdGl2ZURheS5maWxsQ2hlY2tib3goc3VjY2Vzcyk7XHJcbiAgICAgIHRoaXMuY2hlY2tib3hTdGF0ZVVwZGF0ZSgpO1xyXG4gICAgICB0aGlzLmxvY2tlZCA9IHRydWU7XHJcbiAgICAgIHRoaXMuc2F2ZURhdGEoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNoZWNrYm94U3RhdGVVcGRhdGUoKSB7XHJcbiAgICBsZXQgbmV3U3RhdGUgPSAwO1xyXG4gICAgXy5mb3JFYWNoKHRoaXMuY2hlY2tib3hlcywgKGMpID0+IHtcclxuICAgICAgaWYoYy5pc0NoZWNrZWQoKSkge1xyXG4gICAgICAgIG5ld1N0YXRlKys7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGlmKHRoaXMuYWN0aXZlRGF5LnRpbWUgPT09IHRoaXMuY2hlY2tib3hlc1s2XS50aW1lKSB7XHJcbiAgICAgIHRoaXMuZW5kV2VlayhuZXdTdGF0ZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNldFN0YXRlKG5ld1N0YXRlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldEltYWdlKCkge1xyXG4gICAgdGhpcy5pbWFnZSA9IFwifi9pbWFnZXMvaFwiICsgdGhpcy5zdGF0ZSArIFwiL1wiICsgdGhpcy5hY3Rpb24gKyB0aGlzLmZyYW1lICsgXCIucG5nXCI7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhcImltYWdlIGNoYW5nZWQgdG86IFwiICsgdGhpcy5pbWFnZSk7XHJcbiAgfVxyXG5cclxuICBhbmltYXRlKCkge1xyXG4gICAgaWYoZnJhbWVDb3VudHModGhpcy5hY3Rpb24gKyB0aGlzLnN0YXRlKSA+IHRoaXMuZnJhbWUpIHtcclxuICAgICAgdGhpcy5zZXRJbWFnZSgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5tYWtlSWRsZSgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5mcmFtZSsrO1xyXG4gIH1cclxuXHJcbiAgbWFrZUlkbGUoKSB7XHJcbiAgICB0aGlzLnJlc2V0QnVzaW5lc3MoKTtcclxuICAgIHRoaXMuYWN0aW9uID0gJ2knO1xyXG4gICAgdGhpcy5yZXN0YXJ0QW5pbWF0aW9uKCk7XHJcbiAgfVxyXG5cclxuICByZXN0YXJ0QW5pbWF0aW9uKCkge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLmFuaW1hdGlvbklEKTtcclxuICAgIHRoaXMuZnJhbWUgPSAwO1xyXG4gICAgdGhpcy5hbmltYXRpb25JRCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgdGhpcy5hbmltYXRlKCk7XHJcbiAgICB9LCAxMDApO1xyXG4gIH1cclxuXHJcbiAgc2V0U3RhdGUobmV3U3RhdGU6IG51bWJlcikge1xyXG4gICAgY29uc3Qgb2xkU3RhdGUgPSB0aGlzLnN0YXRlO1xyXG4gICAgdGhpcy5zdGF0ZSA9IG5ld1N0YXRlO1xyXG4gICAgaWYobmV3U3RhdGUgIT09IG9sZFN0YXRlKSB7XHJcbiAgICAgIHRoaXMudHJhbnNmb3JtKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm1ha2VJZGxlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBlbmRXZWVrKHN1Y2Nlc3NlczogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmJ1ZGdldC51cGRhdGVUb3RhbChzdWNjZXNzZXMsIHRoaXMudmFsdWUsIHRoaXMuZmFjdG9yLCB0aGlzLnNsYWNrKTtcclxuICAgIHRoaXMuc2V0U3RhdGUoMCk7XHJcbiAgfVxyXG5cclxuICBzYXZlRGF0YSgpIHtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5zZXRTdHJpbmcoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJ2YWx1ZVwiLCB0aGlzLnZhbHVlKTtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5zZXRTdHJpbmcoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJuYW1lXCIsIHRoaXMubmFtZSk7XHJcbiAgICB0aGlzLnNhdmVPYmplY3Quc2V0TnVtYmVyKFwiaFwiICsgdGhpcy5pbmRleCArIFwic3RhdGVJbmRleFwiLCB0aGlzLnN0YXRlKTtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5zZXROdW1iZXIoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJmYWN0b3JcIiwgdGhpcy5mYWN0b3IpO1xyXG4gICAgdGhpcy5zYXZlT2JqZWN0LnNldE51bWJlcihcImhcIiArIHRoaXMuaW5kZXggKyBcInNsYWNrXCIsIHRoaXMuc2xhY2spO1xyXG4gIH1cclxuXHJcbiAgdHJhbnNmb3JtKCkge1xyXG4gICAgdGhpcy50cmFuc2Zvcm1pbmcgPSB0cnVlO1xyXG4gICAgdGhpcy5hY3Rpb24gPSAndCc7XHJcbiAgICB0aGlzLnJlc3RhcnRBbmltYXRpb24oKTtcclxuICB9XHJcblxyXG4gIGFjdCgpIHtcclxuICAgIGlmICh0aGlzLmlzQnVzeSgpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMudHJhbnNmb3JtaW5nID0gZmFsc2U7XHJcbiAgICBjb25zdCBhY3Rpb25UeXBlID0gTWF0aC5yYW5kb20oKSAqIDJcclxuICAgIGlmKGFjdGlvblR5cGUgPCAxICYmIGZyYW1lQ291bnRzKCdhJyArIDApID4gMCkge1xyXG4gICAgICB0aGlzLmFjdGlvbiA9ICdhJztcclxuICAgIH0gZWxzZSBpZiggZnJhbWVDb3VudHMoJ2InICsgMCkgPiAwKSB7XHJcbiAgICAgIHRoaXMuYWN0aW9uID0gJ2InO1xyXG4gICAgfVxyXG4gICAgdGhpcy5yZXN0YXJ0QW5pbWF0aW9uKCk7XHJcbiAgfVxyXG5cclxuICByZXNldEJ1c2luZXNzKCkge1xyXG4gICAgdGhpcy50cmFuc2Zvcm1pbmcgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIGlzQnVzeSgpIHtcclxuICAgIHJldHVybiB0aGlzLnRyYW5zZm9ybWluZztcclxuICB9XHJcblxyXG4gIHVwZGF0ZShuZXdOYW1lOiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcpIHtcclxuICAgIHRoaXMubmFtZSA9IG5ld05hbWU7XHJcbiAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVJbmRleChuZXdJbmRleDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmRlbGV0ZURhdGEoKTtcclxuICAgIHRoaXMuaW5kZXggPSBuZXdJbmRleDtcclxuICAgIHRoaXMuc2F2ZURhdGEoKTtcclxuICAgIHRoaXMuY2hhbmdlQ2hlY2tib3hJbmRpY2VzKCk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVEYXRhKCkge1xyXG4gICAgdGhpcy5zYXZlT2JqZWN0LnJlbW92ZShcImhcIiArIHRoaXMuaW5kZXggKyBcInZhbHVlXCIpO1xyXG4gICAgdGhpcy5zYXZlT2JqZWN0LnJlbW92ZShcImhcIiArIHRoaXMuaW5kZXggKyBcIm5hbWVcIik7XHJcbiAgICB0aGlzLnNhdmVPYmplY3QucmVtb3ZlKFwiaFwiICsgdGhpcy5pbmRleCArIFwic3RhdGVJbmRleFwiKTtcclxuICAgIHRoaXMuc2F2ZU9iamVjdC5yZW1vdmUoXCJoXCIgKyB0aGlzLmluZGV4ICsgXCJmYWN0b3JcIik7XHJcbiAgICB0aGlzLnNhdmVPYmplY3QucmVtb3ZlKFwiaFwiICsgdGhpcy5pbmRleCArIFwic2xhY2tcIik7XHJcbiAgfVxyXG5cclxuICBzZXRDaGVja2JveFRpbWVzKGlzTmV3OiBib29sZWFuKSB7XHJcbiAgICBsZXQgdG9kYXkgPSBNb21lbnQoKS5zdGFydE9mKCd3ZWVrJykuc3VidHJhY3QoMSwgJ2RheXMnKTtcclxuICAgIGlmKCFpc05ldyAmJiAgdGhpcy5jaGVja2JveGVzWzZdLnRpbWUgPCB0b2RheS52YWx1ZU9mKCkpIHtcclxuICAgICAgaWYoIXRoaXMuY2hlY2tib3hlc1s2XS5pc1NldCgpKSB7XHJcbiAgICAgICAgbGV0IG51bUNoZWNrZWQgPSAwO1xyXG4gICAgICAgIF8uZm9yRWFjaCh0aGlzLmNoZWNrYm94ZXMsIChjKSA9PiB7XHJcbiAgICAgICAgICBpZihjLmlzQ2hlY2tlZCgpKSB7XHJcbiAgICAgICAgICAgIG51bUNoZWNrZWQrKztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnN0YXRlID0gMDtcclxuICAgICAgICB0aGlzLmVuZFdlZWsobnVtQ2hlY2tlZCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIF8uZm9yRWFjaCh0aGlzLmNoZWNrYm94ZXMsIChjKSA9PiB7XHJcbiAgICAgICAgYy5yZXNldCgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNzsgaSsrKSB7XHJcbiAgICAgIHRoaXMuY2hlY2tib3hlc1tpXS5zZXRUaW1lKHRvZGF5LmFkZCgxLCAnZGF5cycpLmZvcm1hdCgnZGRkZCBEbyBNTU0nKSwgdG9kYXkudmFsdWVPZigpKTtcclxuICAgICAgaWYodGhpcy5jaGVja2JveGVzW2ldLnRpbWUgPCBNb21lbnQoKS5lbmRPZignZGF5JykudmFsdWVPZigpKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVEYXkgPSB0aGlzLmNoZWNrYm94ZXNbaV07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMubG9ja2VkID0gdGhpcy5hY3RpdmVEYXkuaXNTZXQoKTtcclxuICB9XHJcblxyXG4gIGNoYW5nZUNoZWNrYm94SW5kaWNlcygpIHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNzsgaSsrKSB7XHJcbiAgICAgIHRoaXMuY2hlY2tib3hlc1tpXS5jaGFuZ2VJbmRleCh0aGlzLmluZGV4KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHVwZGF0ZVRhYlRleHQobWF4Q2hhcnM6IDApIHtcclxuICAgIGlmKHRoaXMubmFtZS5sZW5ndGggPiBtYXhDaGFycykge1xyXG4gICAgICB0aGlzLnRhYk5hbWUgPSB0aGlzLm5hbWUuc3Vic3RyaW5nKDAsIG1heENoYXJzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudGFiTmFtZSA9IHRoaXMubmFtZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHN3aXRjaERheShpbmRleDogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmFjdGl2ZURheSA9IHRoaXMuY2hlY2tib3hlc1tpbmRleF07XHJcbiAgICB0aGlzLmxvY2tlZCA9IHRoaXMuYWN0aXZlRGF5LmlzU2V0KCkgfHwgdGhpcy5jaGVja2JveGVzWzZdLmlzU2V0KCk7XHJcbiAgfVxyXG59Il19